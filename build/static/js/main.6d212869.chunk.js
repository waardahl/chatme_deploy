(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1:function(e,t){e.exports={COMMUNITY_CHAT:"COMMUNITY_CHAT",USER_CONNECTED:"USER_CONNECTED",MESSAGE_RECIEVED:"MESSAGE_RECIEVED",MESSAGE_SENT:"MESSAGE_SENT",USER_DISCONNECTED:"USER_DISCONNECTED",TYPING:"TYPING",VERIFY_USER:"VERIFY_USER",LOGOUT:"LOGOUT",PRIVATE_MESSAGE:"PRIVATE_MESSAGE",NEW_CHAT_USER:"NEW_CHAT_USER"}},41:function(e,t,n){var a=n(76),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.filter(function(e){return e!==t}).join(" & ")||"Empty Users"},r=function(e){return"".concat(e.getHours(),":").concat(("0"+e.getMinutes()).slice(-2))};e.exports={createMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=void 0===t?"":t,s=e.sender,o=void 0===s?"":s;return{id:a(),time:r(new Date(Date.now())),message:n,sender:o}},createChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.messages,n=void 0===t?[]:t,r=(e.name,e.users),o=void 0===r?[]:r,i=e.isCommunity,c=void 0!==i&&i;return{id:a(),name:c?"Community":s(o),messages:n,users:o,typingUsers:[],isCommunity:c}},createUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=void 0===t?"":t,s=e.socketId,r=void 0===s?null:s,o=e.coordinates,i=void 0===o?{}:o;return{id:a(),name:n,socketId:r,coordinates:i}},createChatNameFromUsers:s}},42:function(e,t,n){e.exports=n(94)},72:function(e,t){},93:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(8),o=n.n(r),i=n(2),c=n(3),l=n(6),u=n(4),m=n(5),h=n(40),d=n.n(h),p=n(1),v=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setUser=function(e){var t=e.user;e.isUser?n.setError("Username already taken"):""===n.state.nickname?n.setError("Got a name?"):(n.setError(""),n.props.setUser(t))},n.handleSubmit=function(e){e.preventDefault();var t=n.props.socket,a=n.state.nickname,s=n.state.currentPos;t.emit(p.VERIFY_USER,a,s,n.setUser)},n.handleChange=function(e){n.setState({nickname:e.target.value})},n.setError=function(e){n.setState({error:e})},n.setUserCoordinates=function(){navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords;n.setState({currentPos:{lat:t.latitude,lng:t.longitude}})})},n.state={nickname:"",error:"",currentPos:{}},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.nickname,a=t.error;return this.setUserCoordinates(),s.a.createElement("div",{className:"login"},s.a.createElement("form",{onSubmit:this.handleSubmit,className:"login-form"},s.a.createElement("label",{htmlFor:"nickname"},s.a.createElement("h2",null,"Hi! what's your name?")),s.a.createElement("input",{ref:function(t){e.textInput=t},type:"text",id:"nickname",value:n,onChange:this.handleChange,placeholder:"name goes here"}),s.a.createElement("div",{className:"error"},a||null),s.a.createElement("div",{className:"centerit"},s.a.createElement("button",{className:"button"},"enter"))))}}]),t}(a.Component),f=n(26),g=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.chats,n=e.name,a=e.lastMessage,r=e.active,o=e.onClick;return console.log(t),"Empty Users"!==n||t.name!==n?s.a.createElement("div",{className:"user ".concat(r?"active":""),onClick:o},s.a.createElement("div",{className:"user-photo"},n[0].toUpperCase()),s.a.createElement("div",{className:"user-info"},s.a.createElement("div",{className:"name"},n),a&&s.a.createElement("div",{className:"last-message"},a))):s.a.createElement(s.a.Fragment,null)}}]),t}(a.Component);g.defaultProps={lastMessage:"",active:!1,onClick:function(){}};var E=n(7),C=n(41),S=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault();var t=n.state.reciever;(0,n.props.onSendPrivateMessage)(t),n.setState({reciever:""})},n.addChatForUser=function(e){n.props.onSendPrivateMessage(e),n.setActiveSideBar(t.type.CHATS)},n.setActiveSideBar=function(e){n.setState({activeSideBar:e}),n.props.triggerShowMap()},n.state={reciever:"",activeSideBar:t.type.CHATS},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,n=this.props,a=n.chats,r=n.user,o=n.setActiveChat,i=n.logout,c=n.users,l=this.state,u=l.reciever,m=l.activeSideBar;return s.a.createElement("div",{id:"side-bar",className:"noscroll"},s.a.createElement("div",{className:"heading"},s.a.createElement("div",{className:"app-name"},"chatMe"),s.a.createElement("div",{className:"menu"})),s.a.createElement("form",{onSubmit:this.handleSubmit,className:"search"},s.a.createElement("input",{placeholder:"Search",type:"text",value:u,onChange:function(t){e.setState({reciever:t.target.value})}}),s.a.createElement("input",{type:"submit",className:"plus",value:"+"})),s.a.createElement("div",{className:"side-bar-select"},s.a.createElement("div",{onClick:function(){e.setActiveSideBar(t.type.CHATS)},className:"side-bar-select__option ".concat(m===t.type.CHATS?"active":"")},s.a.createElement("span",null,"Chats")),s.a.createElement("div",{onClick:function(){e.setActiveSideBar(t.type.USERS)},className:"side-bar-select__option ".concat(m===t.type.USERS?"active":"")},s.a.createElement("span",null,"Users"))),s.a.createElement("div",{className:"users",ref:"users",onClick:function(t){t.target===e.refs.user&&o(null)}},m===t.type.CHATS?a.map(function(t){return t.name?(console.log(c+r.name),s.a.createElement(g,{key:t.id,users:c,chats:a,name:t.isCommunity?t.name:Object(C.createChatNameFromUsers)(t.users,r.name),lastMessage:Object(E.get)(Object(E.last)(t.messages),"message",""),onClick:function(){e.props.setActiveChat(t)}})):null}):Object(E.differenceBy)(c,[r],"name").map(function(t){return s.a.createElement(g,{key:t.id,name:t.name,onClick:function(){e.addChatForUser(t.name)}})})),s.a.createElement("div",{className:"current-user"},s.a.createElement("span",null,r.name),s.a.createElement("div",{onClick:function(){i()},title:"Logout",className:"logout"},s.a.createElement("p",null,"log out"))))}}]),t}(a.Component);S.type={CHATS:"chats",USERS:"users"};var k=function(e){var t=e.name,n=e.numberOfUsers;return s.a.createElement("div",{className:"chat-header"},s.a.createElement("div",{className:"user-info"},s.a.createElement("div",{className:"user-name"},t),s.a.createElement("div",{className:"status"},s.a.createElement("div",{className:"indicator"}),s.a.createElement("span",null,n||null))))},b=n(14),y=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).scrollDown=n.scrollDown.bind(Object(b.a)(Object(b.a)(n))),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"scrollDown",value:function(){var e=this.refs.container;e.scrollTop=e.scrollHeight}},{key:"componentDidMount",value:function(){this.scrollDown()}},{key:"componentDidUpdate",value:function(e,t){this.scrollDown()}},{key:"render",value:function(){var e=this.props,t=e.messages,n=e.user,a=e.typingUsers;return s.a.createElement("div",{ref:"container",className:"thread-container"},s.a.createElement("div",{className:"thread"},t.map(function(e){return s.a.createElement("div",{key:e.id,className:"message-container ".concat(e.sender===n.name&&"right")},s.a.createElement("div",{className:"time"},e.time),s.a.createElement("div",{className:"data"},s.a.createElement("div",{className:"message"},e.message),s.a.createElement("div",{className:"name"},e.sender)))}),a.map(function(e){return s.a.createElement("div",{key:e,className:"typing-user"},"".concat(e," is typing . . ."))})))}}]),t}(a.Component),O=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),n.sendMessage(),n.setState({message:""})},n.sendMessage=function(){n.props.sendMessage(n.state.message)},n.sendTyping=function(){n.lastUpdateTime=Date.now(),n.state.isTyping||(n.setState({isTyping:!0}),n.props.sendTyping(!0),n.startCheckingTyping())},n.startCheckingTyping=function(){n.typingInterval=setInterval(function(){Date.now()-n.lastUpdateTime>300&&(n.setState({isTyping:!1}),n.stopCheckingTyping())},300)},n.stopCheckingTyping=function(){n.typingInterval&&(clearInterval(n.typingInterval),n.props.sendTyping(!1))},n.state={message:"",isTyping:!1},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){this.stopCheckingTyping()}},{key:"render",value:function(){var e=this,t=this.state.message;return s.a.createElement("div",{className:"message-input"},s.a.createElement("form",{onSubmit:this.handleSubmit,className:"message-form"},s.a.createElement("input",{id:"message",ref:"messageinput",type:"text",className:"form-control",value:t,autoComplete:"off",placeholder:"Type here",onKeyUp:function(t){13!==t.keyCode&&e.sendTyping()},onChange:function(t){var n=t.target;e.setState({message:n.value})}}),s.a.createElement("button",{disabled:t.length<1,type:"submit",className:"send"}," Send ")))}}]),t}(a.Component),N=n(15),M={position:"absolute",width:"69.3%",height:"100%"},U=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={currentLocation:n.props.currentLocation},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.centerAroundCurrentLocation&&this.setState({currentLocation:this.props.user.coordinates}),this.loadMap()}},{key:"componentDidUpdate",value:function(e,t){e.google!==this.props.google&&this.loadMap(),t.currentLocation!==this.state.currentLocation&&this.recenterMap()}},{key:"loadMap",value:function(){if(this.props&&this.props.google){var e=this.props.google.maps,t=this.refs.map,n=o.a.findDOMNode(t),a=this.props.zoom,s=this.state.currentLocation,r=s.lat,i=s.lng,c=new e.LatLng(r,i),l=Object.assign({},{center:c,zoom:a});this.map=new e.Map(n,l)}}},{key:"recenterMap",value:function(){var e=this.map,t=this.state.currentLocation,n=this.props.google.maps;if(e){var a=new n.LatLng(t.lat,t.lng);e.panTo(a)}}},{key:"renderChildren",value:function(){var e=this,t=this.props.children;if(t)return s.a.Children.map(t,function(t){if(t)return s.a.cloneElement(t,{map:e.map,google:e.props.google,mapCenter:e.state.currentLocation})})}},{key:"render",value:function(){var e=Object.assign({},M);return s.a.createElement("div",null,s.a.createElement("div",{style:e,ref:"map"},"Loading map..."),this.renderChildren())}}]),t}(s.a.Component),T=U;U.defaultProps={zoom:14,initialCenter:{lat:-1.2884,lng:36.8233},centerAroundCurrentLocation:!1,visible:!0};var j=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).createMarkers=function(){for(var e=n.props.users,t=n.props.user,a=[],r=0;r<e.length;r++)e[r].name!==t.name&&a.push(s.a.createElement(N.Marker,{onClick:n.onMarkerClickTrue,name:"Here's you friend "+e[r].name,position:e[r].coordinates,key:r}));return a},n.onMarkerClickTrue=function(e,t,a){n.setState({selectedPlace:e,activeMarker:t,showingInfoWindow:!0,showChatButton:!0})},n.onMarkerClickFalse=function(e,t,a){n.setState({selectedPlace:e,activeMarker:t,showingInfoWindow:!0,showChatButton:!1})},n.onClose=function(e){n.state.showingInfoWindow&&n.setState({showingInfoWindow:!1,activeMarker:null})},n.showButtonInfoWindow=function(){var e=[];return!0===n.state.showChatButton&&e.push(s.a.createElement("button",{key:1},"Start baby chat")),e},n.state={showingInfoWindow:!1,showChatButton:!0,activeMarker:{},selectedPlace:{},currentLocation:n.props.user.coordinates},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.users;return s.a.createElement(T,{centerAroundCurrentLocation:!0,google:this.props.google,user:t,users:n,currentLocation:this.state.currentLocation},s.a.createElement(N.Marker,{onClick:this.onMarkerClickFalse,name:"you are here "+t.name}),this.createMarkers(),s.a.createElement(N.InfoWindow,{marker:this.state.activeMarker,visible:this.state.showingInfoWindow,onClose:this.onClose},s.a.createElement("div",{className:"infoboxLocation"},s.a.createElement("h4",null,this.state.selectedPlace.name),this.showButtonInfoWindow())))}}]),t}(a.Component),w=Object(N.GoogleApiWrapper)({apiKey:"AIzaSyAvuy-sA7Rllb8GKEsLNpcw5OAd4ff8ecc"})(j),A=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).sendOpenPrivateMessage=function(e){var t=n.props,a=t.socket,s=t.user,r=n.state.activeChat;a.emit(p.PRIVATE_MESSAGE,{reciever:e,sender:s.name,activeChat:r})},n.addUserToChat=function(e){var t=e.chatId,a=e.newUser,s=n.state.chats.map(function(e){return e.id===t?Object.assign({},e,{users:[].concat(Object(f.a)(e.users),[a])}):e});n.setState({chats:s})},n.removeUsersFromChat=function(e){var t=n.state.chats.map(function(t){var n=Object(E.difference)(t.users,e.map(function(e){return e.name}));return Object.assign({},t,{users:n})});n.setState({chats:t})},n.resetChat=function(e){return n.addChat(e,!0)},n.addChat=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=n.props.socket,s=n.state.chats,r=t?[e]:[].concat(Object(f.a)(s),[e]);n.setState({chats:r});var o="".concat(p.MESSAGE_RECIEVED,"-").concat(e.id),i="".concat(p.TYPING,"-").concat(e.id);a.on(i,n.updateTypingInChat(e.id)),a.on(o,n.addMessageToChat(e.id))},n.addMessageToChat=function(e){return function(t){var a=n.state.chats.map(function(n){return n.id===e&&n.messages.push(t),n});n.setState({chats:a})}},n.updateTypingInChat=function(e){return function(t){var a=t.isTyping,s=t.user;if(s!==n.props.user.name){var r=n.state.chats.map(function(t){return t.id===e&&(a&&!t.typingUsers.includes(s)?t.typingUsers.push(s):!a&&t.typingUsers.includes(s)&&(t.typingUsers=t.typingUsers.filter(function(e){return e!==s}))),t});n.setState({chats:r})}}},n.sendMessage=function(e,t){n.props.socket.emit(p.MESSAGE_SENT,{chatId:e,message:t})},n.sendTyping=function(e,t){n.props.socket.emit(p.TYPING,{chatId:e,isTyping:t})},n.setActiveChat=function(e){n.setState({activeChat:e}),n.setState({showMap:!1})},n.showMapUserClick=function(){n.setState({showMap:!0})},n.state={chats:[],users:[],activeChat:null,showMap:!1},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.socket;this.initSocket(e)}},{key:"componentWillUnmount",value:function(){var e=this.props.socket;e.off(p.PRIVATE_MESSAGE),e.off(p.USER_CONNECTED),e.off(p.USER_DISCONNECTED),e.off(p.NEW_CHAT_USER)}},{key:"initSocket",value:function(e){var t=this;e.emit(p.COMMUNITY_CHAT,this.resetChat),e.on(p.PRIVATE_MESSAGE,this.addChat),e.on("connect",function(){e.emit(p.COMMUNITY_CHAT,t.resetChat)}),e.on(p.USER_CONNECTED,function(e){t.setState({users:Object(E.values)(e)})}),e.on(p.USER_DISCONNECTED,function(e){var n=Object(E.differenceBy)(t.state.users,Object(E.values)(e),"id");t.removeUsersFromChat(n),t.setState({users:Object(E.values)(e)})}),e.on(p.NEW_CHAT_USER,this.addUserToChat)}},{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.logout,r=this.state,o=r.chats,i=r.activeChat,c=r.users,l=r.showMap;return console.log(n),console.log(c),null!==i&&!1===l?s.a.createElement("div",{className:"container"},s.a.createElement(S,{logout:a,chats:o,user:n,users:c,activeChat:i,setActiveChat:this.setActiveChat,onSendPrivateMessage:this.sendOpenPrivateMessage,triggerShowMap:this.showMapUserClick}),s.a.createElement("div",{className:"chat-room-container"},s.a.createElement("div",{className:"chat-room"},s.a.createElement(k,{name:i.name}),s.a.createElement(y,{messages:i.messages,user:n,typingUsers:i.typingUsers}),s.a.createElement(O,{sendMessage:function(t){e.sendMessage(i.id,t)},sendTyping:function(t){e.sendTyping(i.id,t)}})))):s.a.createElement("div",{className:"container"},s.a.createElement(S,{logout:a,chats:o,user:n,users:c,activeChat:i,setActiveChat:this.setActiveChat,onSendPrivateMessage:this.sendOpenPrivateMessage,triggerShowMap:this.showMapUserClick}),s.a.createElement("div",{className:"chat-room-container"},s.a.createElement("div",{className:"chat-room choose"},s.a.createElement(w,{user:n,users:c}))))}}]),t}(a.Component),I="/",_=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).initSocket=function(){var e=d()(I);e.on("connect",function(){n.state.user?n.reconnect(e):console.log("Connected")}),n.setState({socket:e})},n.reconnect=function(e){e.emit(p.VERIFY_USER,n.state.user.name,n.state.user.coordinates,function(e){var t=e.isUser,a=e.user;t?n.setState({user:null}):n.setUser(a)})},n.setUser=function(e){n.state.socket.emit(p.USER_CONNECTED,e),n.setState({user:e}),console.log(e)},n.logout=function(){n.state.socket.emit(p.LOGOUT),n.setState({user:null})},n.state={socket:null,user:null},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){this.initSocket()}},{key:"render",value:function(){var e=this.state,t=e.socket,n=e.user;return s.a.createElement("div",{className:"container"},n?s.a.createElement(A,{socket:t,user:n,logout:this.logout}):s.a.createElement(v,{socket:t,setUser:this.setUser}))}}]),t}(a.Component),D=(n(93),function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(_,null)}}]),t}(a.Component)),R=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function L(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}o.a.render(s.a.createElement(D,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");R?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):L(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):L(e)})}}()}},[[42,1,2]]]);
//# sourceMappingURL=main.6d212869.chunk.js.map